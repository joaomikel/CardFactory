<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CardFactory - Magic Market</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* (He mantenido tus estilos intactos, solo oculto para ahorrar espacio aqu√≠) */
        :root { --primary: #816EB2; --secondary: #958EA0; --text-dark: #222; --text-light: #f4f4f4; --white: #ffffff; --radius: 12px; --shadow: 0 4px 15px rgba(0,0,0,0.1); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: #f9f9f9; color: var(--text-dark); min-height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; }
        header { background: transparent; height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; position: absolute; width: 100%; top: 0; z-index: 100; }
        .menu-trigger { font-size: 1.8rem; background: none; border: none; color: var(--white); cursor: pointer; text-shadow: 0 2px 4px rgba(0,0,0,0.5); padding: 10px; }
        .auth-actions { display: flex; gap: 10px; }
        .btn-header { padding: 8px 16px; border-radius: 20px; font-weight: 600; text-decoration: none; font-size: 0.85rem; transition: 0.3s; white-space: nowrap; }
        .btn-login { background: rgba(255,255,255,0.25); color: var(--white); border: 1px solid rgba(255,255,255,0.5); backdrop-filter: blur(4px); }
        .btn-register { background: var(--primary); color: var(--white); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 101; opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(2px); }
        .sidebar-overlay.active { opacity: 1; pointer-events: all; }
        .sidebar { position: fixed; top: 0; left: -100%; width: 85%; max-width: 320px; height: 100%; background: var(--white); z-index: 102; padding: 2rem; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; gap: 1rem; box-shadow: 5px 0 15px rgba(0,0,0,0.2); }
        .sidebar.active { left: 0; }
        .close-sidebar { position: absolute; top: 20px; right: 20px; font-size: 2rem; background: none; border: none; cursor: pointer; color: #666; }
        .sidebar a { padding: 15px 10px; font-weight: 500; color: var(--secondary); border-bottom: 1px solid #eee; text-decoration: none; font-size: 1.1rem; }
        .hero-search { position: relative; padding: 120px 20px 60px 20px; display: flex; justify-content: center; align-items: center; background: linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(129, 110, 178, 0.85) 100%), url('img/Black Lotus.jpg'); background-size: cover; background-position: center; margin-bottom: 30px; }
        .search-wrapper { width: 100%; max-width: 600px; position: relative; }
        .search-wrapper input { width: 100%; padding: 18px 55px 18px 25px; font-size: 16px; border: none; border-radius: 50px; outline: none; box-shadow: 0 8px 20px rgba(0,0,0,0.25); }
        .search-btn { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: var(--primary); color: white; width: 44px; height: 44px; border-radius: 50%; border: none; cursor: pointer; font-size: 1.2rem; }
        .container { width: 100%; padding: 0 20px; margin: 0 auto; flex: 1; }
        h2 { font-size: 1.4rem; margin-bottom: 20px; color: var(--text-dark); border-left: 5px solid var(--primary); padding-left: 15px; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .card-item { background: var(--white); padding: 10px; border-radius: var(--radius); box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center; display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; }
        .card-item:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }
        .card-item img { width: 100%; border-radius: 8px; margin-bottom: 10px; aspect-ratio: 2.5/3.5; object-fit: cover; }
        .card-price { color: var(--primary); font-weight: bold; font-size: 1.1rem; transition: color 0.3s; }
        .editions-scroller { display: flex; gap: 15px; overflow-x: auto; padding: 10px 5px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .editions-scroller::-webkit-scrollbar { display: none; }
        .edition-badge { min-width: 180px; height: 110px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-weight: 800; color: white; text-transform: uppercase; text-shadow: 0 2px 5px rgba(0,0,0,0.8); box-shadow: 0 4px 10px rgba(0,0,0,0.15); background-size: cover; background-position: center; position: relative; overflow: hidden; flex-shrink: 0; cursor: pointer; transition: transform 0.2s; }
        .edition-badge:hover { transform: scale(1.02); }
        .edition-badge::before { content: ''; position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, rgba(129, 110, 178, 0.85) 100%); z-index: 1; }
        .edition-badge span { position: relative; z-index: 2; text-align: center; font-size: 1rem; padding: 0 10px; }
        .section-footer { width: 100%; display: flex; justify-content: center; margin-top: 25px; margin-bottom: 10px; }
        .btn-more { background: transparent; color: var(--primary); border: 2px solid var(--primary); padding: 10px 30px; border-radius: 30px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; }
        .btn-more:hover { background: var(--primary); color: var(--white); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(129, 110, 178, 0.4); }
        .reviews-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 40px; }
        .review-card { background: white; padding: 20px; border-radius: var(--radius); display: flex; gap: 15px; align-items: start; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-top: 4px solid var(--secondary); }
        .avatar { width: 50px; height: 50px; border-radius: 50%; background: #eee; object-fit: cover; border: 2px solid var(--primary); }
        footer { margin-top: auto; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: var(--text-light); padding-top: 60px; }
        .footer-content { display: grid; grid-template-columns: 1fr; gap: 40px; max-width: 1200px; margin: 0 auto; padding: 0 20px 40px 20px; }
        .footer-section h3 { font-size: 1.2rem; margin-bottom: 20px; color: var(--white); }
        .footer-section p { font-size: 0.9rem; line-height: 1.6; opacity: 0.9; }
        .footer-links { list-style: none; }
        .footer-links li { margin-bottom: 12px; }
        .footer-links a { text-decoration: none; color: var(--text-light); transition: 0.3s; font-size: 0.95rem; opacity: 0.8; }
        .footer-links a:hover { color: var(--white); opacity: 1; padding-left: 5px; }
        .social-icons { display: flex; gap: 15px; margin-top: 20px; }
        .social-icons a { width: 40px; height: 40px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; border-radius: 50%; color: var(--white); text-decoration: none; transition: 0.3s; }
        .social-icons a:hover { background: var(--primary); transform: translateY(-3px); }
        .footer-bottom { background: rgba(0,0,0,0.2); padding: 20px; text-align: center; font-size: 0.85rem; }
        @media (min-width: 768px) { header { padding: 0 40px; height: 90px; } .hero-search { padding: 160px 40px 80px 40px; } .container { max-width: 760px; } .cards-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; } .reviews-grid { grid-template-columns: repeat(2, 1fr); } .edition-badge { min-width: 240px; height: 140px; } .footer-content { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .container { max-width: 1200px; padding: 0 40px; } .reviews-grid { grid-template-columns: repeat(3, 1fr); } .sidebar { width: 300px; } .footer-content { grid-template-columns: repeat(4, 1fr); } }
    </style>
</head>
<body>

    <div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <button class="close-sidebar" onclick="toggleMenu()">&times;</button>
        <h3 style="color: var(--primary); margin-bottom: 1rem;">Men√∫</h3>
        <a href="#">Perfil</a>
        <a href="/colecciones/">Colecciones</a>
        <a href="/catalogo/">Cat√°logo</a>
        <a href="#">Carrito</a>
    </div>

    <header>
        <button class="menu-trigger" onclick="toggleMenu()" aria-label="Men√∫">&#9776;</button>
        <div class="auth-actions">
             <a href="/login" class="btn-header btn-login">Login</a>
            <a href="/register" class="btn-header btn-register">Registro</a>
        </div>
    </header>

    <section class="hero-search">
        <div class="search-wrapper">
            <input type="text" placeholder="Search cards (e.g., Sheoldred)..." id="searchInput">
            <button class="search-btn" aria-label="Buscar">üîç</button>
        </div>
    </section>

    <main class="container">
        
        <section>
            <h2>Trending Cards (Docker Backend)</h2>
            <div class="cards-grid" id="trending-container">
                <p style="grid-column: 1/-1; text-align: center;">Conectando con Backend Local...</p>
            </div>
            <div class="section-footer">
                <button class="btn-more">Ver m√°s...</button>
            </div>
        </section>

        <br><br>

        <section>
            <h2>Nueva Colecci√≥n: Lorwyn</h2>
            <div class="cards-grid" id="lorwyn-container">
                <p style="grid-column: 1/-1; text-align: center;">Cargando Lorwyn desde API...</p>
            </div>
            <div class="section-footer">
                <button class="btn-more">Ver m√°s...</button>
            </div>
        </section>

        <br><br>

        <section>
            <h2>Colecciones Destacadas</h2>
            <div class="editions-scroller">
                <div class="edition-badge" style="background-image: url('img/lowyn.jpg');">
                    <span>Lorwyn Eclipsed</span>
                </div>
                <div class="edition-badge" style="background-image: url('img/Tarkir.jpg');">
                    <span>Tarkir Dragons</span>
                </div>
                <div class="edition-badge" style="background-image: url('img/inistrad.jpg');">
                    <span>Innistrad Rem.</span>
                </div>
                <div class="edition-badge" style="background-image: url('img/Ravinika.jpg');">
                    <span>Ravnica Rem.</span>
                </div>
            </div>
            <div class="section-footer">
                <button class="btn-more">Ver m√°s...</button>
            </div>
        </section>

        <br><br>

        <section>
            <h2>Rese√±as de Usuarios</h2>
            <div class="reviews-grid" id="reviews-container"></div>
        </section>

    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>CardFactory</h3>
                <p>Tu mercado de confianza para comprar y vender cartas de Magic: The Gathering.</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Enlaces R√°pidos</h3>
                <ul class="footer-links">
                    <li><a href="/catalogo/">Cat√°logo</a></li>
                    <li><a href="#">Vender</a></li>
                    <li><a href="#">Nosotros</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Soporte</h3>
                <ul class="footer-links">
                    <li><a href="#">Ayuda</a></li>
                    <li><a href="#">Contacto</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Newsletter</h3>
                <div style="display: flex; margin-top: 15px;">
                    <input type="email" placeholder="Email..." style="padding: 10px; border:none; border-radius: 8px 0 0 8px; width:100%;">
                    <button style="padding: 10px; background: var(--primary); color:white; border:none; border-radius: 0 8px 8px 0;">Ir</button>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 CardFactory.</p>
        </div>
    </footer>

    <script>
        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        function createCardHTML(card) {
            const img = card.image_uris?.normal || (card.card_faces && card.card_faces[0].image_uris.normal) || 'https://via.placeholder.com/488x680';
            let finalPrice = 'Sin Stock';
            if (card.prices.eur) finalPrice = `${card.prices.eur} ‚Ç¨`;
            else if (card.prices.usd) finalPrice = `${card.prices.usd} $`;

            return `
                <div class="card-item">
                    <img src="${img}" alt="${card.name}" loading="lazy">
                    <h3>${card.name}</h3>
                    <p class="card-price">${finalPrice}</p>
                </div>
            `;
        }

        // CAMBIO: Ahora llama a tu backend, no a Scryfall directamente
        async function loadTrendingCards() {
            const container = document.getElementById('trending-container');
            try {
                // LLAMADA LOCAL
                const res = await fetch('/api/trending');
                const data = await res.json();
                
                // Si el backend devuelve mock data, usamos data.data
                const cards = data.data || [];
                
                if(cards.length > 0){
                    container.innerHTML = cards.map(createCardHTML).join('');
                } else {
                    container.innerHTML = '<p>No hay tendencias hoy.</p>';
                }
            } catch (error) {
                console.error('Error tendencias:', error);
                container.innerHTML = '<p>Error de conexi√≥n.</p>';
            }
        }

        // CAMBIO: Llamada a endpoint espec√≠fico de Lorwyn
        async function loadLorwynCards() {
            const container = document.getElementById('lorwyn-container');
            try {
                const res = await fetch('/api/lorwyn');
                const data = await res.json();
                
                const cards = data.data || [];
                
                if(cards.length > 0){
                    container.innerHTML = cards.map(createCardHTML).join('');
                } else {
                    container.innerHTML = '<p>No se encontraron cartas.</p>';
                }
            } catch (error) {
                console.error('Error Lorwyn:', error);
            }
        }

        function loadReviews() {
            const reviews = [
                { name: "Adrian DLC", text: "Me encanta ver los precios actualizados.", img: "https://i.pravatar.cc/150?u=a" },
                { name: "Marina G.", text: "El dise√±o de Lorwyn me parece incre√≠ble.", img: "https://i.pravatar.cc/150?u=b" },
                { name: "Carlos R.", text: "Muy intuitivo desde el m√≥vil.", img: "https://i.pravatar.cc/150?u=c" }
            ];
            
            document.getElementById('reviews-container').innerHTML = reviews.map(r => `
                <div class="review-card">
                    <img src="${r.img}" class="avatar" alt="User">
                    <div>
                        <strong>${r.name}</strong>
                        <p style="color:#555; font-size:0.9rem;">"${r.text}"</p>
                    </div>
                </div>
            `).join('');
        }

        window.onload = () => {
            loadTrendingCards();
            loadLorwynCards();
            loadReviews();
            
            // Nota: Con mock data, el setInterval no cambiar√° nada visualmente, pero funciona
            setInterval(() => {
                loadTrendingCards();
            }, 10000); 
        };
    </script>
</body>
</html>